(function(a,n){typeof exports=="object"&&typeof module!="undefined"?module.exports=n(require("element-plus"),require("@panhezeng/utils/dist/check-upload.js"),require("@panhezeng/utils/dist/get-object-item-by-path.js"),require("vue")):typeof define=="function"&&define.amd?define(["element-plus","@panhezeng/utils/dist/check-upload.js","@panhezeng/utils/dist/get-object-item-by-path.js","vue"],n):(a=typeof globalThis!="undefined"?globalThis:a||self,a.ElSingleUpload=n(a.ElementPlus,a.checkUpload,a.getObjectItemByPath,a.Vue))})(this,function(a,n,h,t){"use strict";function c(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var u=c(n),f=c(h),S="",g=(e,r)=>{const l=e.__vccOpts||e;for(const[s,i]of r)l[s]=i;return l};const y={name:"ElSingleUpload",components:{ElProgress:a.ElProgress,ElUpload:a.ElUpload,ElInput:a.ElInput,ElPopconfirm:a.ElPopconfirm},inheritAttrs:!1,props:{upload:{required:!0,type:Function},resPathOfUrl:{type:String,default:"data.url"},url:{type:null,required:!0},checkUpload:{type:Function,default:null},error:{type:Function,default:null},deleteButton:{type:Boolean,default:!0},view:{type:Boolean,default:!0},size:{type:Number,default:void 0},imageDimensions:{validator(e){return/^\[object Object\]$/.test(Object.prototype.toString.call(e))&&Object.prototype.hasOwnProperty.call(e,"width")&&Object.prototype.hasOwnProperty.call(e,"height")},type:Object,default(){return{width:void 0,height:void 0}}},accept:{validator(e){return e===""||/^(image|audio|video|text|application|\.)/.test(e)},type:String,default:""},input:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},drag:{type:Boolean,default:!0},errorUploadEmptyUrl:{type:Boolean,default:!1},tip:{type:String,default:""}},data(){return{file:null,urlInternal:"",percentage:100,emptyUrl:!1,readonlyInternal:!1,timeoutId:0,localMedia:{url:"",duration:0,el:null}}},computed:{acceptClassName(){return/^\.(png|jpe?g|gif|svg|webp)/i.test(this.accept)||/^image/i.test(this.accept)?"image":/^\.(ogg|mp3|wav|flac|aac)/i.test(this.accept)||/^audio/i.test(this.accept)?"audio":/^\.(mp4|webm)/i.test(this.accept)||/^video/i.test(this.accept)?"video":""}},watch:{url:{immediate:!0,handler(e){this.emptyUrl=!0,this.setUrl(e),this.emptyUrl=this.errorUploadEmptyUrl}},errorUploadEmptyUrl:{immediate:!0,handler(e){this.emptyUrl=e}},readonly:{immediate:!0,handler(e){this.readonlyInternal=e}}},beforeUnmount(){this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=0),this.$refs.media&&(this.$refs.media.removeEventListener("loadedmetadata",this.emitMedia),this.$refs.media.removeEventListener("error",this.emitMediaError))},methods:{empty(e=!0){e&&(this.urlInternal="",this.$refs.upload&&this.$refs.upload.clearFiles()),this.file=null,this.$emit("file",null),this.$emit("media-duration",""),this.$emit("media",null),this.$emit("update:url",this.urlInternal)},clearUploadTimeout(){this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=0)},emitMedia(e=!1){this.clearUploadTimeout(),e===!0?(this.$emit("media-duration",this.localMedia.duration),this.$emit("media",this.localMedia.el)):this.$refs.media&&(this.$emit("media-duration",this.$refs.media.duration),this.$emit("media",this.$refs.media))},emitMediaError(){this.clearUploadTimeout(),this.$emit("media-load-error")},loadedmetadataHandler(){(this.acceptClassName==="video"||this.acceptClassName==="audio")&&(this.localMedia.duration?this.emitMedia(!0):this.$nextTick().then(()=>{this.$refs.media&&(this.$refs.media.addEventListener("loadedmetadata",()=>this.emitMedia()),this.$refs.media.readyState>2&&this.emitMedia(),this.$refs.media.addEventListener("error",this.emitMediaError.bind(this)),this.clearUploadTimeout(),this.timeoutId=window.setTimeout(()=>{this.emitMediaError()},6e4))}))},setUrl(e){Object.prototype.toString.call(e)==="[object String]"&&(/^https?:\/\//i.test(e)?(this.urlInternal=e,this.loadedmetadataHandler()):this.empty(this.emptyUrl),this.urlInternal!==this.url&&this.$emit("update:url",this.urlInternal))},beforeUpload(e){return this.readonlyInternal=!0,this.file=e,this.$emit("file",e),this.$emit("before-upload",e),this.checkUpload?this.checkUpload(e):new Promise((r,l)=>{u.default(e,this.accept,this.size,this.imageDimensions.width,this.imageDimensions.height).then(s=>{if(s.validation){if(this.acceptClassName==="video"||this.acceptClassName==="audio"){this.localMedia.url=URL.createObjectURL(e);const i=this.localMedia.el=document.createElement(this.acceptClassName);i.preload="metadata",i.addEventListener("loadedmetadata",()=>{this.localMedia.duration=i.duration}),i.addEventListener("error",()=>{this.localMedia.duration=0}),i.src=this.localMedia.url}r(!0)}else s.message&&a.ElMessage.error(s.message),this.readonlyInternal=this.readonly,this.$emit("validation-error"),l()})})},requestUpload(e){return this.$emit("request-upload",e),this.upload(e)},progressUpload(e){this.$emit("progress-upload",e);let r=0;typeof e.percent=="number"&&(r=e.percent),r>=100&&(r=99),this.percentage=Math.floor(r)},successUpload(e){this.setUrl(f.default(e,this.resPathOfUrl)),this.percentage=100,this.$emit("success-upload",e),this.finishUpload()},errorUpload(e,r){this.percentage=100,this.error?this.error(e,r):a.ElMessage.error("\u4E0A\u4F20\u5931\u8D25"),this.empty(this.emptyUrl),this.$emit("error-upload",{err:e,file:r}),this.finishUpload()},finishUpload(){this.readonlyInternal=this.readonly,this.$emit("finish-upload")},deleteConfirm(){this.$emit("delete-confirm"),this.empty()},progressFormat(){return this.percentage===99?"\u6587\u4EF6\u4E0A\u4F20\u4E2D...":this.percentage>99?"\u6587\u4EF6\u4E0A\u4F20\u5B8C\u6210":`\u6587\u4EF6\u8BFB\u53D6${this.percentage}%`}}},U={key:0,class:"view-box"},_=["src"],E=["src"],k=["href"],w=["src"],b={key:1,style:{display:"inline-block",padding:"10px 15px"}},B=[t.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg","data-v-ba633cb8":""},[t.createElementVNode("path",{fill:"currentColor",d:"M544 864V672h128L512 480 352 672h128v192H320v-1.6c-5.376.32-10.496 1.6-16 1.6A240 240 0 0 1 64 624c0-123.136 93.12-223.488 212.608-237.248A239.808 239.808 0 0 1 512 192a239.872 239.872 0 0 1 235.456 194.752c119.488 13.76 212.48 114.112 212.48 237.248a240 240 0 0 1-240 240c-5.376 0-10.56-1.28-16-1.6v1.6H544z"})],-1)],I=t.createElementVNode("div",{class:"icon-delete"},[t.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg","data-v-ba633cb8":""},[t.createElementVNode("path",{fill:"currentColor",d:"M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32V256zm448-64v-64H416v64h192zM224 896h576V256H224v640zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32zm192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32z"})])],-1),C={key:5,class:"tip"};function M(e,r,l,s,i,o){const j=t.resolveComponent("el-progress"),N=t.resolveComponent("el-upload"),V=t.resolveComponent("el-popconfirm"),O=t.resolveComponent("el-input");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["el-single-upload",{[o.acceptClassName]:!0,input:l.input}])},[l.view&&i.urlInternal?(t.openBlock(),t.createElementBlock("div",U,[o.acceptClassName==="video"?(t.openBlock(),t.createElementBlock("video",{key:0,ref:"media",class:"view",controls:"",preload:"metadata",src:i.urlInternal},null,8,_)):o.acceptClassName==="audio"?(t.openBlock(),t.createElementBlock("audio",{key:1,ref:"media",class:"view",controls:"",preload:"metadata",src:i.urlInternal},null,8,E)):(t.openBlock(),t.createElementBlock("a",{key:2,href:i.urlInternal,target:"_blank",class:"view"},[o.acceptClassName==="image"?(t.openBlock(),t.createElementBlock("img",{key:0,class:"img",src:i.urlInternal},null,8,w)):(t.openBlock(),t.createElementBlock("span",b,t.toDisplayString(i.file?i.file.name:i.urlInternal),1))],8,k))])):t.createCommentVNode("",!0),i.percentage!==100?(t.openBlock(),t.createBlock(j,{key:1,percentage:i.percentage,"text-inside":!0,"stroke-width":20,format:o.progressFormat},null,8,["percentage","format"])):t.createCommentVNode("",!0),e.$attrs.disabled?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(N,t.mergeProps({key:2,ref:"upload",class:["upload",{update:i.urlInternal}]},e.$attrs,{action:"","before-upload":o.beforeUpload,"http-request":o.requestUpload,"on-progress":o.progressUpload,"on-success":o.successUpload,"on-error":o.errorUpload,accept:l.accept,drag:l.drag,multiple:!1,"show-file-list":!1}),{default:t.withCtx(()=>[t.createElementVNode("div",{class:t.normalizeClass(`el-icon-upload ${i.urlInternal?"re-upload-btn":"upload-btn"}`)},B,2)]),_:1},16,["class","before-upload","http-request","on-progress","on-success","on-error","accept","drag"])),i.urlInternal&&l.deleteButton&&!e.$attrs.disabled?(t.openBlock(),t.createBlock(V,t.mergeProps({key:3,title:"\u60A8\u786E\u8BA4\u5220\u9664\uFF1F"},e.$attrs,{"button-show":!1,onConfirm:o.deleteConfirm}),{reference:t.withCtx(()=>[I]),_:1},16,["onConfirm"])):t.createCommentVNode("",!0),l.input?(t.openBlock(),t.createBlock(O,{key:4,modelValue:i.urlInternal,"onUpdate:modelValue":r[0]||(r[0]=m=>i.urlInternal=m),placeholder:e.$attrs.placeholder||"\u6587\u4EF6\u94FE\u63A5\u5730\u5740",disabled:e.$attrs.disabled,readonly:i.readonlyInternal,onBlur:r[1]||(r[1]=m=>o.setUrl(i.urlInternal))},null,8,["modelValue","placeholder","disabled","readonly"])):t.createCommentVNode("",!0),l.tip?(t.openBlock(),t.createElementBlock("div",C,t.toDisplayString(l.tip),1)):t.createCommentVNode("",!0),t.renderSlot(e.$slots,"default")],2)}var d=g(y,[["render",M]]);const p=Object.assign(d,{install:(e,r=typeof window!="undefined"&&window.ElSingleUploadOptions&&typeof window.ElSingleUploadOptions=="object"?window.ElSingleUploadOptions:{})=>{Object.assign(p.props,r),e.component(d.name,d)}});return p});
